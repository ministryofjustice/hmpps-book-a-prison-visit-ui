{% extends "partials/layout.njk" %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/warning-text/macro.njk" import govukWarningText %}

{% set activeLink = 'visitors-link' %}
{% set pageTitle = "Visitors" %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      <h1 class="govuk-heading-l">{{ pageTitle }}</h1>

      <h2 class="govuk-heading-m">
        <span data-test="prisoner-name">{{ prisoner | prisonerNameFirstLast }}</span>’s visitors
      </h2>

      {% if visitors | length %}

        {% set displayRows = [] %}

        {% for visitor in visitors %}
          {% set displayRows = (displayRows.push([
            {
              text: visitor.firstName + " " + visitor.lastName,
              attributes: {
                "data-test": "visitor-name-" + loop.index
              }
            },
            { 
              text: visitor.dateOfBirth | formatDate,
              attributes: {
                "data-test": "visitor-dob-" + loop.index
              }
            },
            {
              text: visitor.canVisitorBook.text,
              classes: visitor.canVisitorBook.class,
              attributes: {
                "data-test": "visitor-availability-" + loop.index
              }
            }
          ]), displayRows)%}
        {% endfor %}
       
        {{ govukTable({
          firstCellIsHeader: false,
          head: [
            {
              text: "Name"
            },
            {
              text: "Date of birth"
            },
            {
              text: "Can you book a visit for them?"
            }
          ],
          rows: displayRows
        }) }}

      {% else %}
        {{ govukWarningText({
          text: "No visitors are currently approved.",
          iconFallbackText: "Warning",
          attributes: { "data-test": "no-visitors" }
        }) }}
      {% endif %}

      <h2 class="govuk-heading-m">Waiting for approval</h2>
      <p>If you have already submitted a request to add visitors, we will contact you when your request has been approved or rejected.</p>
      <p>We will respond within 5 working days.</p>

      <h2 class="govuk-heading-m">Add a new visitor</h2>
      <p>The person you want to book for must be on the prisoner’s visitor list.</p>
      <p>
        To make a request,
        <a href="https://visit-someone-in-prison-add-visitor.form.service.justice.gov.uk/">complete the form</a>.
        We will respond within 5 working days.
      </p>

    </div>
  </div>
{% endblock %}
